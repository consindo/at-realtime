(window["webpackJsonpwaka-manager"]=window["webpackJsonpwaka-manager"]||[]).push([[0],{43:function(e,t,a){e.exports=a(63)},49:function(e,t,a){},63:function(e,t,a){"use strict";a.r(t);var n=a(0),r=a.n(n),c=a(21),l=a.n(c),o=(a(48),a(49),a(11)),i=a.n(o),u=a(19),m=a(8),s=a(75),p=a(37),f=a(81),d=a(64),E=a(65),h=a(66),b=a(67),g=a(68),k=a(69);function v(e){var t=e.createWorker,a=Object(n.useState)(!1),c=Object(m.a)(a,2),l=c[0],o=c[1],i=Object(n.useState)(""),u=Object(m.a)(i,2),s=u[0],v=u[1],w=Object(n.useState)(""),x=Object(m.a)(w,2),j=x[0],O=x[1],y=Object(n.useState)(""),C=Object(m.a)(y,2),S=C[0],N=C[1],R=Object(n.useState)(""),F=Object(m.a)(R,2),I=F[0],D=F[1],J=Object(n.useState)(""),W=Object(m.a)(J,2),z=W[0],T=W[1],V=Object(n.useState)(!1),A=Object(m.a)(V,2),P=A[0],B=A[1],M=!s||!j||!S||!I||!z,L=r.a.createElement("button",{className:"close btn btn-round",type:"button",onClick:function(){return o(!1)}},r.a.createElement("span",{"aria-hidden":"true"},"\xd7"));return r.a.createElement(r.a.Fragment,null,r.a.createElement(p.a,{outline:!0,color:"primary",onClick:function(){return o(!0)}},"Create Worker"),r.a.createElement(f.a,{isOpen:l,toggle:function(){return o(!1)},backdrop:"static"},r.a.createElement(d.a,{close:L},"Create Worker"),r.a.createElement(E.a,null,r.a.createElement(h.a,null,r.a.createElement(b.a,{htmlFor:"workerPrefix"},"Prefix"),r.a.createElement(g.a,{onChange:function(e){return v(e.target.value)},type:"text",id:"workerPrefix",placeholder:"us-nyc",value:s})),r.a.createElement(h.a,null,r.a.createElement(b.a,{htmlFor:"workerVersion"},"Version"),r.a.createElement(g.a,{onChange:function(e){return O(e.target.value)},type:"text",id:"workerVersion",placeholder:"20180706-12345",value:j})),r.a.createElement(h.a,null,r.a.createElement(b.a,{htmlFor:"workerVersion"},"Shapes Container"),r.a.createElement(g.a,{onChange:function(e){return N(e.target.value)},type:"text",id:"workerShapesContainer",placeholder:"shapes-us-west-2.waka.app",value:S})),r.a.createElement(h.a,null,r.a.createElement(b.a,{htmlFor:"workerVersion"},"Shapes Region"),r.a.createElement(g.a,{onChange:function(e){return D(e.target.value)},type:"text",id:"workerShapesRegion",placeholder:"us-west-2",value:I})),r.a.createElement(h.a,null,r.a.createElement(b.a,{htmlFor:"workerDbconfig"},"DB Config ",r.a.createElement("code",null,"config.db[yourConfig]")),r.a.createElement(g.a,{onChange:function(e){return T(e.target.value)},type:"text",id:"workerDbconfig",placeholder:"local",value:z})),r.a.createElement(h.a,{check:!0},r.a.createElement(g.a,{onChange:function(e){return B(e.target.checked)},type:"checkbox",className:"form-check-Input",id:"workerNewRealtime",checked:P}),r.a.createElement(b.a,{className:"form-check-Label",htmlFor:"workerNewRealtime"},"New Realtime (experimental)"))),r.a.createElement(k.a,null,r.a.createElement(p.a,{color:"secondary",onClick:function(){return o(!1)}},"Cancel"),r.a.createElement(p.a,{color:"primary",onClick:function(){t(s,j,S,I,z,P)},disabled:M},"Create Worker"))))}var w=a(70),x=a(71),j=a(72),O=a(73),y=a(74),C=function(e){var t=e.worker,a=e.mapping,c=void 0===a?{}:a,l=e.runAction,o={id:t.id,prefix:t.prefix},i=Object(n.useState)(!1),u=Object(m.a)(i,2),s=u[0],f=u[1],d=function(e){return l(e,o)},E=r.a.createElement(w.a,{pill:!0,color:"warning"},"inactive"),h=r.a.createElement(p.a,{onClick:function(){return d("/mapping/set")},color:"light",size:"sm"},"activate"),b="";t.id===c.value&&(E=r.a.createElement(w.a,{pill:!0,color:"success"},"active"),h=r.a.createElement(p.a,{onClick:function(){return d("/mapping/delete")},color:"danger",size:"sm"},"unmap"),b=r.a.createElement(r.a.Fragment,null,r.a.createElement(x.a,{onClick:function(){return d("/worker/recycle")}},"Recycle Service"),r.a.createElement(x.a,{divider:!0})));var g=r.a.createElement(j.a,{size:"sm",isOpen:s,toggle:function(){return f(!s)}},r.a.createElement(O.a,{color:"light",caret:!0},"actions"),r.a.createElement(y.a,null,b,r.a.createElement(x.a,{onClick:function(){return d("/worker/docker")}},"Get Docker Import Command"),r.a.createElement(x.a,{onClick:function(){return d("/worker/status/pendingimport")}},"Start Import (pending)"),r.a.createElement(x.a,{onClick:function(){return d("/worker/status/pendingimport-willmap")}},"Start Import & Map (pending)"),r.a.createElement(x.a,{onClick:function(){return d("/worker/status/imported")}},"Set Status to Imported"),r.a.createElement(x.a,{onClick:function(){return d("/worker/status/imported-willmap")}},"Set Status to Imported & Map"),r.a.createElement(x.a,{divider:!0}),r.a.createElement(x.a,{onClick:function(){return d("/worker/delete")}},"Delete Worker")));return r.a.createElement("tr",{"data-id":t.id,"data-prefix":t.prefix},r.a.createElement("td",null,r.a.createElement("a",{href:"../".concat(t.prefix,"/info")},t.prefix)),r.a.createElement("td",null,t.version),r.a.createElement("td",{className:"td-truncate",title:t.dbname},t.dbname),r.a.createElement("td",null,t.status),r.a.createElement("td",null,E),r.a.createElement("td",null,t.newRealtime?"True":"False"),r.a.createElement("td",null,h,g))},S=function(e){var t=e.modal,a=e.toggle,n=e.content,c=e.fn,l=r.a.createElement("button",{className:"close btn btn-round",type:"button",onClick:a},r.a.createElement("span",{"aria-hidden":"true"},"\xd7"));return r.a.createElement(f.a,{isOpen:t,toggle:a,backdrop:"static"},r.a.createElement(d.a,{close:l},"Alert"),r.a.createElement(E.a,null,n),c&&r.a.createElement(k.a,null,r.a.createElement(p.a,{onClick:c},"Submit")))},N=function(){var e=Object(n.useState)([]),t=Object(m.a)(e,2),a=t[0],c=t[1],l=Object(n.useState)(null),o=Object(m.a)(l,2),p=o[0],f=o[1],d=Object(n.useState)(!1),E=Object(m.a)(d,2),h=E[0],b=E[1],g=Object(n.useState)(!1),k=Object(m.a)(g,2),w=k[0],x=k[1],j=Object(n.useState)(""),O=Object(m.a)(j,2),y=O[0],N=O[1],R=function(e){w?(N(""),x(!1)):(N(e),x(!0))},F=function(){var e=Object(u.a)(i.a.mark((function e(t,a){var n,r;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch(t,{method:"post",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)});case 2:return n=e.sent,e.next=5,n.json();case 5:(r=e.sent).command&&R(r.command),I(!1);case 8:case"end":return e.stop()}}),e)})));return function(t,a){return e.apply(this,arguments)}}(),I=function(){var e=Object(u.a)(i.a.mark((function e(){var t,a,n,r,l,o=arguments;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=!(o.length>0&&void 0!==o[0])||o[0],e.prev=1,t&&b(!0),e.next=5,fetch("/mapping");case 5:return a=e.sent,e.next=8,a.json();case 8:return n=e.sent,f(n),e.next=12,fetch("/worker");case 12:return r=e.sent,e.next=15,r.json();case 15:l=e.sent,c(l),t&&b(!1),e.next=23;break;case 20:e.prev=20,e.t0=e.catch(1),console.error(e.t0);case 23:case"end":return e.stop()}}),e,null,[[1,20]])})));return function(){return e.apply(this,arguments)}}();return Object(n.useEffect)((function(){I()}),[]),r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{className:"d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center mb-2"},r.a.createElement("h2",null,"Workers"),r.a.createElement("div",{className:"btn-toolbar mb-2 mb-md-0"},r.a.createElement(v,null))),r.a.createElement("div",{id:"workers",className:"mb-4"},h||0===a.length?"Loading...":r.a.createElement(s.a,null,r.a.createElement("thead",null,r.a.createElement("tr",null,r.a.createElement("th",null,"Prefix"),r.a.createElement("th",null,"Version"),r.a.createElement("th",null,"DB Name"),r.a.createElement("th",null,"Import Status"),r.a.createElement("th",null,"Status"),r.a.createElement("th",null,"New Realtime?"),r.a.createElement("th",null,"Control"))),r.a.createElement("tbody",null,a.map((function(e){return r.a.createElement(C,{key:e.id,worker:e,mapping:p[e.prefix],runAction:F})}))))),r.a.createElement("div",null,r.a.createElement("h5",null,"Instructions"),r.a.createElement("ul",null,r.a.createElement("li",null,"To add a worker, either turn on an auto-updater, or grab a version string from"," ",r.a.createElement("a",{href:"https:waka.app/a/nz-wlg/info"},"waka.app/a/nz-wlg/info"),"."),r.a.createElement("li",null,"If you're running this locally, the import is not automatic. Use the actions menu to get a Docker command that will populate your database."),r.a.createElement("li",null,"If you use the Docker command, shapes will also not be imported by default."))),w&&r.a.createElement(S,{toggle:R,content:y,modal:w}))},R=a(76),F=a(77),I=a(78),D=a(79),J=a(80),W=a(24),z=function(){return r.a.createElement(R.a,{color:"dark",dark:!0,expand:"md"},r.a.createElement(F.a,{className:"d-flex justify-content-between"},r.a.createElement(W.b,{to:"/",className:"navbar-brand d-flex align-items-center"},r.a.createElement("strong",null,"Waka"),"\xa0Orchestrator"),r.a.createElement(I.a,{className:"collapse navbar-collapse",id:"navbarCollapse"},r.a.createElement(D.a,{className:"mr-auto"},r.a.createElement(J.a,null,r.a.createElement(W.b,{to:"/config",className:"nav-link"},"Configuration"))))))},T=a(18),V=function(){var e=Object(n.useState)(""),t=Object(m.a)(e,2),a=t[0],c=t[1],l=Object(n.useState)(""),o=Object(m.a)(l,2),s=o[0],f=o[1],d=Object(n.useState)(""),E=Object(m.a)(d,2),h=E[0],b=E[1],g=Object(n.useState)(!1),k=Object(m.a)(g,2),v=k[0],w=k[1],x=Object(n.useState)(""),j=Object(m.a)(x,2),O=j[0],y=j[1],C=Object(n.useState)(!1),N=Object(m.a)(C,2),R=N[0],F=N[1],I=function(e){v?(y(""),w(!1)):(y(e),w(!0))},D=function(){F(!R)},J=function(){var e=Object(u.a)(i.a.mark((function e(){return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,W("/orchestrator/kill");case 3:D(),e.next=9;break;case 6:e.prev=6,e.t0=e.catch(0),I("something bad happened");case 9:case"end":return e.stop()}}),e,null,[[0,6]])})));return function(){return e.apply(this,arguments)}}(),W=function(){var e=Object(u.a)(i.a.mark((function e(t,a){var n,r;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch(t,{method:"post",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)});case 2:return n=e.sent,e.next=5,n.json();case 5:(r=e.sent).command&&I(r.command),z();case 8:case"end":return e.stop()}}),e)})));return function(t,a){return e.apply(this,arguments)}}(),z=function(){var e=Object(u.a)(i.a.mark((function e(){var t,a;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch("/config");case 2:return t=e.sent,e.next=5,t.json();case 5:a=e.sent,c(JSON.stringify(a.config," ",2)),f(JSON.stringify(a.configRealtime," ",2));case 8:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),T=function(){var e=Object(u.a)(i.a.mark((function e(){var t,a;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch("/git");case 2:return t=e.sent,e.next=5,t.text();case 5:a=e.sent,b(a);case 7:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return Object(n.useEffect)((function(){z(),T()}),[]),r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{className:"mb-4"},r.a.createElement("h4",null,"Deployed Version"),r.a.createElement("div",{className:"bg-dark"},r.a.createElement("pre",{className:"text-light p-4",id:"footer"},h))),r.a.createElement("div",{className:"d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center mb-1"},r.a.createElement("h2",null,"Config"),r.a.createElement("div",{className:"btn-toolbar mb-2 mb-md-0"},r.a.createElement(p.a,{size:"sm",outline:!0,color:"danger",onClick:D},"Restart Orchestrator"),"\xa0",r.a.createElement(p.a,{size:"sm",outline:!0,color:"primary",onClick:function(){try{var e={config:JSON.parse(a),configRealtime:JSON.parse(s)};W("/config",e)}catch(t){I("Error in JSON")}}},"Save Config"))),r.a.createElement("div",{className:"mb-4"},r.a.createElement("div",{className:"form-group"},r.a.createElement("textarea",{className:"form-control pre",id:"configTextarea",rows:"36",value:a,onChange:function(e){return c(e.target.value)}}),r.a.createElement("small",{className:"form-text text-muted"},"You can override the"," ",r.a.createElement("a",{href:"https://github.com/dymajo/waka-server/blob/master/waka-orchestrator/configManager.js"},"default config")," ","by putting values in here. However, you will need to restart the app!"))),r.a.createElement("h2",null,"Realtime Config"),r.a.createElement("div",{className:"mb-4"},r.a.createElement("div",{className:"form-group"},r.a.createElement("textarea",{className:"form-control pre",id:"configRealtimeTextarea",rows:"16",value:s,onChange:function(e){return f(e.target.value)}}),r.a.createElement("small",{className:"form-text text-muted"},"This configuration is only used if realtime is running as a seperate process. When running as seperate processes, it is recommended that you change the keyvalue implementation to dynamo."))),v&&r.a.createElement(S,{toggle:I,content:O,modal:v}),R&&r.a.createElement(S,{toggle:D,content:"Are you sure you want to restart the orchestrator?\nDepending on your environment, it may not restart automatically.",modal:R,fn:J}))};var A=function(){return r.a.createElement(W.a,null,r.a.createElement(z,null),r.a.createElement("div",{className:"container main-container pt-5"},r.a.createElement(T.c,null,r.a.createElement(T.a,{exact:!0,path:"/config",component:V}),r.a.createElement(T.a,{exact:!0,path:"/",component:N}))))};l.a.render(r.a.createElement(A,null),document.getElementById("root"))}},[[43,1,2]]]);
//# sourceMappingURL=main.0db69e37.chunk.js.map