(this["webpackJsonpwaka-manager"]=this["webpackJsonpwaka-manager"]||[]).push([[0],{41:function(e,t,a){e.exports=a(61)},47:function(e,t,a){},61:function(e,t,a){"use strict";a.r(t);var n=a(0),r=a.n(n),c=a(21),l=a.n(c),o=(a(46),a(47),a(11)),u=a.n(o),i=a(15),s=a(8),m=a(73),p=a(37),f=a(79),d=a(62),E=a(63),b=a(64),h=a(65),g=a(66),v=a(67);function k(e){var t=e.createWorker,a=Object(n.useState)(!1),c=Object(s.a)(a,2),l=c[0],o=c[1],m=Object(n.useState)(""),k=Object(s.a)(m,2),j=k[0],w=k[1],O=Object(n.useState)(""),x=Object(s.a)(O,2),y=x[0],C=x[1],S=Object(n.useState)(""),N=Object(s.a)(S,2),I=N[0],F=N[1],R=Object(n.useState)(""),D=Object(s.a)(R,2),J=D[0],W=D[1],z=Object(n.useState)(""),V=Object(s.a)(z,2),T=V[0],A=V[1],B=Object(n.useState)(!1),M=Object(s.a)(B,2),P=M[0],L=M[1],G=Object(n.useState)(!1),H=Object(s.a)(G,2),U=H[0],Y=H[1],q=Object(n.useState)([]),K=Object(s.a)(q,2),Q=K[0],X=K[1],Z=function(){var e=Object(i.a)(u.a.mark((function e(){var t,a,n;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return Y(!0),e.next=3,fetch("/private/prefixes");case 3:return t=e.sent,e.next=6,t.json();case 6:a=e.sent,n=Object.keys(a).map((function(e){return{label:a[e].longName,value:e}})),X(n),Y(!1);case 10:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();Object(n.useEffect)((function(){Z()}),[]);var $=!j||!y||!I||!J||!T,_=r.a.createElement("button",{className:"close btn btn-round",type:"button",onClick:function(){return o(!1)}},r.a.createElement("span",{"aria-hidden":"true"},"\xd7"));return r.a.createElement(r.a.Fragment,null,r.a.createElement(p.a,{outline:!0,color:"primary",onClick:function(){return o(!0)}},"Create Worker"),r.a.createElement(f.a,{isOpen:l,toggle:function(){return o(!1)},backdrop:"static"},r.a.createElement(d.a,{close:_},"Create Worker"),r.a.createElement(E.a,null,r.a.createElement(b.a,null,r.a.createElement(h.a,{htmlFor:"workerPrefix"},"Prefix"),r.a.createElement(g.a,{type:"select",disabled:U||0===Q.length,onChange:function(e){return w(e.target.options[e.target.selectedIndex].value)}},Q.map((function(e){return r.a.createElement("option",{key:e.value,value:e.value},e.label)})))),r.a.createElement(b.a,null,r.a.createElement(h.a,{htmlFor:"workerVersion"},"Version"),r.a.createElement(g.a,{onChange:function(e){return C(e.target.value)},type:"text",placeholder:"20180706-12345",value:y})),r.a.createElement(b.a,null,r.a.createElement(h.a,{htmlFor:"workerVersion"},"Shapes Container"),r.a.createElement(g.a,{onChange:function(e){return F(e.target.value)},type:"text",placeholder:"shapes-us-west-2.waka.app",value:I})),r.a.createElement(b.a,null,r.a.createElement(h.a,{htmlFor:"workerVersion"},"Shapes Region"),r.a.createElement(g.a,{onChange:function(e){return W(e.target.value)},type:"text",placeholder:"us-west-2",value:J})),r.a.createElement(b.a,null,r.a.createElement(h.a,{htmlFor:"workerDbconfig"},"DB Config ",r.a.createElement("code",null,"config.db[yourConfig]")),r.a.createElement(g.a,{onChange:function(e){return A(e.target.value)},type:"text",placeholder:"local",value:T})),r.a.createElement(b.a,{check:!0},r.a.createElement(g.a,{onChange:function(e){return L(e.target.checked)},type:"checkbox",className:"form-check-Input",checked:P}),r.a.createElement(h.a,{className:"form-check-Label",htmlFor:"workerNewRealtime"},"New Realtime (experimental)"))),r.a.createElement(v.a,null,r.a.createElement(p.a,{color:"secondary",onClick:function(){return o(!1)}},"Cancel"),r.a.createElement(p.a,{color:"primary",onClick:function(){t(j,y,I,J,T,P)},disabled:$},"Create Worker"))))}var j=a(68),w=a(69),O=a(70),x=a(71),y=a(72),C=function(e){var t=e.worker,a=e.mapping,c=void 0===a?{}:a,l=e.runAction,o={id:t.id,prefix:t.prefix},u=Object(n.useState)(!1),i=Object(s.a)(u,2),m=i[0],f=i[1],d=function(e){return l(e,o)},E=r.a.createElement(j.a,{pill:!0,color:"warning"},"inactive"),b=r.a.createElement(p.a,{onClick:function(){return d("mapping/set")},color:"light",size:"sm"},"activate"),h="";t.id===c.value&&(E=r.a.createElement(j.a,{pill:!0,color:"success"},"active"),b=r.a.createElement(p.a,{onClick:function(){return d("mapping/delete")},color:"danger",size:"sm"},"unmap"),h=r.a.createElement(r.a.Fragment,null,r.a.createElement(w.a,{onClick:function(){return d("worker/recycle")}},"Recycle Service"),r.a.createElement(w.a,{divider:!0})));var g=r.a.createElement(O.a,{size:"sm",isOpen:m,toggle:function(){return f(!m)}},r.a.createElement(x.a,{color:"light",caret:!0},"actions"),r.a.createElement(y.a,null,h,r.a.createElement(w.a,{onClick:function(){return d("worker/docker")}},"Get Docker Import Command"),r.a.createElement(w.a,{onClick:function(){return d("worker/status/pendingimport")}},"Start Import (pending)"),r.a.createElement(w.a,{onClick:function(){return d("worker/status/pendingimport-willmap")}},"Start Import & Map (pending)"),r.a.createElement(w.a,{onClick:function(){return d("worker/status/imported")}},"Set Status to Imported"),r.a.createElement(w.a,{onClick:function(){return d("worker/status/imported-willmap")}},"Set Status to Imported & Map"),r.a.createElement(w.a,{divider:!0}),r.a.createElement(w.a,{onClick:function(){return d("worker/delete")}},"Delete Worker")));return r.a.createElement("tr",null,r.a.createElement("td",null,r.a.createElement("a",{href:"../".concat(t.prefix,"/info")},t.prefix)),r.a.createElement("td",null,t.version),r.a.createElement("td",{className:"td-truncate",title:t.dbname},t.dbname),r.a.createElement("td",null,t.status),r.a.createElement("td",null,E),r.a.createElement("td",null,t.newRealtime?"True":"False"),r.a.createElement("td",null,b,g))},S=function(e){var t=e.modal,a=e.toggle,n=e.content,c=e.fn,l=r.a.createElement("button",{className:"close btn btn-round",type:"button",onClick:a},r.a.createElement("span",{"aria-hidden":"true"},"\xd7"));return r.a.createElement(f.a,{isOpen:t,toggle:a,backdrop:"static"},r.a.createElement(d.a,{close:l},"Alert"),r.a.createElement(E.a,null,n),c&&r.a.createElement(v.a,null,r.a.createElement(p.a,{onClick:c},"Submit")))},N=function(){var e=Object(n.useState)([]),t=Object(s.a)(e,2),a=t[0],c=t[1],l=Object(n.useState)(null),o=Object(s.a)(l,2),p=o[0],f=o[1],d=Object(n.useState)(!1),E=Object(s.a)(d,2),b=E[0],h=E[1],g=Object(n.useState)(!1),v=Object(s.a)(g,2),j=v[0],w=v[1],O=Object(n.useState)(""),x=Object(s.a)(O,2),y=x[0],N=x[1],I=function(e){j?(N(""),w(!1)):(N(e),w(!0))},F=function(){var e=Object(i.a)(u.a.mark((function e(t,a){var n,r;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch("/private/".concat(t),{method:"post",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)});case 2:return n=e.sent,e.next=5,n.json();case 5:(r=e.sent).command&&I(r.command),R(!1);case 8:case"end":return e.stop()}}),e)})));return function(t,a){return e.apply(this,arguments)}}(),R=function(){var e=Object(i.a)(u.a.mark((function e(){var t,a,n,r,l,o=arguments;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=!(o.length>0&&void 0!==o[0])||o[0],e.prev=1,t&&h(!0),e.next=5,fetch("/private/mapping");case 5:return a=e.sent,e.next=8,a.json();case 8:return n=e.sent,f(n),e.next=12,fetch("/private/worker");case 12:return r=e.sent,e.next=15,r.json();case 15:l=e.sent,c(l),t&&h(!1),e.next=23;break;case 20:e.prev=20,e.t0=e.catch(1),console.error(e.t0);case 23:case"end":return e.stop()}}),e,null,[[1,20]])})));return function(){return e.apply(this,arguments)}}();return Object(n.useEffect)((function(){R()}),[]),r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{className:"d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center mb-2"},r.a.createElement("h2",null,"Workers"),r.a.createElement("div",{className:"btn-toolbar mb-2 mb-md-0"},r.a.createElement(k,null))),r.a.createElement("div",{id:"workers",className:"mb-4"},b||0===a.length?"Loading...":r.a.createElement(m.a,null,r.a.createElement("thead",null,r.a.createElement("tr",null,r.a.createElement("th",null,"Prefix"),r.a.createElement("th",null,"Version"),r.a.createElement("th",null,"DB Name"),r.a.createElement("th",null,"Import Status"),r.a.createElement("th",null,"Status"),r.a.createElement("th",null,"New Realtime?"),r.a.createElement("th",null,"Control"))),r.a.createElement("tbody",null,a.map((function(e){return r.a.createElement(C,{key:e.id,worker:e,mapping:p[e.prefix],runAction:F})}))))),r.a.createElement("div",null,r.a.createElement("h5",null,"Instructions"),r.a.createElement("ul",null,r.a.createElement("li",null,"To add a worker, either turn on an auto-updater, or grab a version string from"," ",r.a.createElement("a",{href:"https:waka.app/a/nz-wlg/info"},"waka.app/a/nz-wlg/info"),"."),r.a.createElement("li",null,"If you're running this locally, the import is not automatic. Use the actions menu to get a Docker command that will populate your database."),r.a.createElement("li",null,"If you use the Docker command, shapes will also not be imported by default."))),j&&r.a.createElement(S,{toggle:I,content:y,modal:j}))},I=a(74),F=a(75),R=a(76),D=a(77),J=a(78),W=a(24),z=function(){return r.a.createElement(I.a,{color:"dark",dark:!0,expand:"md"},r.a.createElement(F.a,{className:"d-flex justify-content-between"},r.a.createElement(W.b,{to:"/",className:"navbar-brand d-flex align-items-center"},r.a.createElement("strong",null,"Waka"),"\xa0Orchestrator"),r.a.createElement(R.a,{className:"collapse navbar-collapse",id:"navbarCollapse"},r.a.createElement(D.a,{className:"mr-auto",navbar:!0},r.a.createElement(J.a,null,r.a.createElement(W.b,{to:"/config",className:"nav-link"},"Configuration"))))))},V=a(19),T=function(){var e=Object(n.useState)(""),t=Object(s.a)(e,2),a=t[0],c=t[1],l=Object(n.useState)(""),o=Object(s.a)(l,2),m=o[0],f=o[1],d=Object(n.useState)(""),E=Object(s.a)(d,2),b=E[0],h=E[1],g=Object(n.useState)(!1),v=Object(s.a)(g,2),k=v[0],j=v[1],w=Object(n.useState)(""),O=Object(s.a)(w,2),x=O[0],y=O[1],C=Object(n.useState)(!1),N=Object(s.a)(C,2),I=N[0],F=N[1],R=function(e){k?(y(""),j(!1)):(y(e),j(!0))},D=function(){F(!I)},J=function(){var e=Object(i.a)(u.a.mark((function e(){return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,W("orchestrator/kill");case 3:D(),e.next=9;break;case 6:e.prev=6,e.t0=e.catch(0),R("something bad happened");case 9:case"end":return e.stop()}}),e,null,[[0,6]])})));return function(){return e.apply(this,arguments)}}(),W=function(){var e=Object(i.a)(u.a.mark((function e(t,a){var n,r;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch("/private/".concat(t),{method:"post",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)});case 2:return n=e.sent,e.next=5,n.json();case 5:(r=e.sent).command&&R(r.command),z();case 8:case"end":return e.stop()}}),e)})));return function(t,a){return e.apply(this,arguments)}}(),z=function(){var e=Object(i.a)(u.a.mark((function e(){var t,a;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch("/private/config");case 2:return t=e.sent,e.next=5,t.json();case 5:a=e.sent,c(JSON.stringify(a.config," ",2)),f(JSON.stringify(a.configRealtime," ",2));case 8:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),V=function(){var e=Object(i.a)(u.a.mark((function e(){var t,a;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch("/private/git");case 2:return t=e.sent,e.next=5,t.text();case 5:a=e.sent,h(a);case 7:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return Object(n.useEffect)((function(){z(),V()}),[]),r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{className:"mb-4"},r.a.createElement("h4",null,"Deployed Version"),r.a.createElement("div",{className:"bg-dark"},r.a.createElement("pre",{className:"text-light p-4",id:"footer"},b))),r.a.createElement("div",{className:"d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center mb-1"},r.a.createElement("h2",null,"Config"),r.a.createElement("div",{className:"btn-toolbar mb-2 mb-md-0"},r.a.createElement(p.a,{size:"sm",outline:!0,color:"danger",onClick:D},"Restart Orchestrator"),"\xa0",r.a.createElement(p.a,{size:"sm",outline:!0,color:"primary",onClick:function(){try{var e={config:JSON.parse(a),configRealtime:JSON.parse(m)};W("config",e)}catch(t){R("Error in JSON")}}},"Save Config"))),r.a.createElement("div",{className:"mb-4"},r.a.createElement("div",{className:"form-group"},r.a.createElement("textarea",{className:"form-control pre",rows:"36",value:a,onChange:function(e){return c(e.target.value)}}),r.a.createElement("small",{className:"form-text text-muted"},"You can override the"," ",r.a.createElement("a",{href:"https://github.com/dymajo/waka-server/blob/master/waka-orchestrator/configManager.js"},"default config")," ","by putting values in here. However, you will need to restart the app!"))),r.a.createElement("h2",null,"Realtime Config"),r.a.createElement("div",{className:"mb-4"},r.a.createElement("div",{className:"form-group"},r.a.createElement("textarea",{className:"form-control pre",rows:"16",value:m,onChange:function(e){return f(e.target.value)}}),r.a.createElement("small",{className:"form-text text-muted"},"This configuration is only used if realtime is running as a seperate process. When running as seperate processes, it is recommended that you change the keyvalue implementation to dynamo."))),k&&r.a.createElement(S,{toggle:R,content:x,modal:k}),I&&r.a.createElement(S,{toggle:D,content:"Are you sure you want to restart the orchestrator?\nDepending on your environment, it may not restart automatically.",modal:I,fn:J}))};var A=function(){return r.a.createElement(W.a,{basename:"/private"},r.a.createElement(z,null),r.a.createElement("div",{className:"container main-container pt-5"},r.a.createElement(V.c,null,r.a.createElement(V.a,{exact:!0,path:"/config",component:T}),r.a.createElement(V.a,{exact:!0,path:"/",component:N}))))};l.a.render(r.a.createElement(A,null),document.getElementById("root"))}},[[41,1,2]]]);
//# sourceMappingURL=main.bc404622.chunk.js.map