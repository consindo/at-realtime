(this["webpackJsonpwaka-manager"]=this["webpackJsonpwaka-manager"]||[]).push([[0],{49:function(e,t,a){e.exports=a(79)},55:function(e,t,a){},79:function(e,t,a){"use strict";a.r(t);var n=a(0),r=a.n(n),c=a(22),l=a.n(c),o=(a(54),a(55),a(11)),i=a.n(o),s=a(15),u=a(8),m=a(88),p=a(45),f=a(94),d=a(80),E=a(81),b=a(82),g=a(83),h=a(84),v=a(85);function k(e){var t=e.createWorker,a=Object(n.useState)(!1),c=Object(u.a)(a,2),l=c[0],o=c[1],m=Object(n.useState)(""),k=Object(u.a)(m,2),w=k[0],j=k[1],x=Object(n.useState)(""),O=Object(u.a)(x,2),y=O[0],C=O[1],N=Object(n.useState)("shapes-us-west-2.waka.app"),S=Object(u.a)(N,2),F=S[0],R=S[1],A=Object(n.useState)("us-west-2"),D=Object(u.a)(A,2),I=D[0],J=D[1],W=Object(n.useState)("local"),z=Object(u.a)(W,2),T=z[0],V=z[1],B=Object(n.useState)(!0),G=Object(u.a)(B,2),L=G[0],M=G[1],P=Object(n.useState)(!1),H=Object(u.a)(P,2),U=H[0],Y=H[1],q=Object(n.useState)([]),K=Object(u.a)(q,2),Q=K[0],X=K[1],Z=function(){var e=Object(s.a)(i.a.mark((function e(){var t,a,n;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return Y(!0),e.next=3,fetch("/private/prefixes");case 3:return t=e.sent,e.next=6,t.json();case 6:a=e.sent,(n=Object.keys(a).map((function(e){return{label:a[e].longName,value:e}}))).sort((function(e,t){return e.label.localeCompare(t.label,"en",{sensitivity:"base"})})),j(n[0].value),X(n),Y(!1);case 12:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();Object(n.useEffect)((function(){Z()}),[]);var $=!w||!y||!F||!I||!T,_=r.a.createElement("button",{className:"close btn btn-round",type:"button",onClick:function(){return o(!1)}},r.a.createElement("span",{"aria-hidden":"true"},"\xd7"));return r.a.createElement(r.a.Fragment,null,r.a.createElement(p.a,{outline:!0,color:"primary",onClick:function(){return o(!0)}},"Create Worker"),r.a.createElement(f.a,{isOpen:l,toggle:function(){return o(!1)},backdrop:"static"},r.a.createElement(d.a,{close:_},"Create Worker"),r.a.createElement(E.a,null,r.a.createElement(b.a,null,r.a.createElement(g.a,{htmlFor:"workerPrefix"},"Prefix"),r.a.createElement(h.a,{type:"select",disabled:U||0===Q.length,onChange:function(e){return j(e.target.options[e.target.selectedIndex].value)}},Q.map((function(e){return r.a.createElement("option",{key:e.value,value:e.value},e.label)})))),r.a.createElement(b.a,null,r.a.createElement(g.a,{htmlFor:"workerVersion"},"Version"),r.a.createElement(h.a,{onChange:function(e){return C(e.target.value)},type:"text",value:y})),r.a.createElement(b.a,null,r.a.createElement(g.a,{htmlFor:"workerVersion"},"Shapes Container"),r.a.createElement(h.a,{onChange:function(e){return R(e.target.value)},type:"text",value:F})),r.a.createElement(b.a,null,r.a.createElement(g.a,{htmlFor:"workerVersion"},"Shapes Region"),r.a.createElement(h.a,{onChange:function(e){return J(e.target.value)},type:"text",value:I})),r.a.createElement(b.a,null,r.a.createElement(g.a,{htmlFor:"workerDbconfig"},"DB Config ",r.a.createElement("code",null,"config.db[yourConfig]")),r.a.createElement(h.a,{onChange:function(e){return V(e.target.value)},type:"text",value:T})),r.a.createElement(b.a,{check:!0},r.a.createElement(h.a,{onChange:function(e){return M(e.target.checked)},type:"checkbox",className:"form-check-Input",checked:L}),r.a.createElement(g.a,{className:"form-check-Label",htmlFor:"workerNewRealtime"},"New Realtime (experimental)"))),r.a.createElement(v.a,null,r.a.createElement(p.a,{color:"secondary",onClick:function(){return o(!1)}},"Cancel"),r.a.createElement(p.a,{color:"primary",onClick:function(){t({prefix:w,version:y,shapesContainer:F,shapesRegion:I,dbconfig:T,newRealtime:L}),o(!1)},disabled:$},"Create Worker"))))}var w=a(86),j=a(87),x=a(95),O=a(96),y="..";"uat-admin.waka.app"===window.location.hostname&&(y="https://uat.waka.app/a"),"admin.waka.app"===window.location.hostname&&(y="https://waka.app/a");var C=function(e){var t=e.worker,a=e.mapping,c=void 0===a?{}:a,l=e.runAction,o={id:t.id,prefix:t.prefix},i=Object(n.useState)(!1),s=Object(u.a)(i,2),m=s[0],f=s[1],d=function(e){return l(e,o)},E=r.a.createElement(p.a,{onClick:function(){return d("mapping/set")},color:"light",size:"sm"},"activate"),b="";t.id===c.value&&(E=r.a.createElement(p.a,{onClick:function(){return d("mapping/delete")},color:"danger",size:"sm"},"unmap"),b=r.a.createElement(r.a.Fragment,null,r.a.createElement(w.a,{onClick:function(){return d("worker/recycle")}},"Recycle Service"),r.a.createElement(w.a,{divider:!0})));var g=r.a.createElement(j.a,{className:"d-inline-block",size:"sm",isOpen:m,toggle:function(){return f(!m)}},r.a.createElement(x.a,{color:"light",caret:!0},"actions"),r.a.createElement(O.a,null,b,r.a.createElement(w.a,{onClick:function(){return d("worker/docker")}},"Get Docker Import Command"),r.a.createElement(w.a,{onClick:function(){return d("worker/status/pendingimport")}},"Start Import (pending)"),r.a.createElement(w.a,{onClick:function(){return d("worker/status/pendingimport-willmap")}},"Start Import & Map (pending)"),r.a.createElement(w.a,{onClick:function(){return d("worker/status/imported")}},"Set Status to Imported"),r.a.createElement(w.a,{onClick:function(){return d("worker/status/imported-willmap")}},"Set Status to Imported & Map"),r.a.createElement(w.a,{divider:!0}),r.a.createElement(w.a,{onClick:function(){return d("worker/delete")}},"Delete Worker")));return r.a.createElement("tr",null,r.a.createElement("td",{className:"pl-0"},t.id===c.value?r.a.createElement(r.a.Fragment,null,r.a.createElement("a",{href:"".concat(y,"/").concat(t.prefix,"/info")},t.prefix)," \u2b50"):t.prefix,r.a.createElement("br",null),r.a.createElement("small",{className:"text-muted"},t.newRealtime?"GTFS-R":"No GTFS-R")),r.a.createElement("td",null,t.version,r.a.createElement("br",null),r.a.createElement("small",null,r.a.createElement("code",null,r.a.createElement("strong",null,"DB:")," ",t.dbname))),r.a.createElement("td",null,t.createdAt?new Date(t.createdAt).toLocaleString():"Creation unknown",r.a.createElement("br",null),r.a.createElement("small",{className:t.status.includes("imported")?"text-success":"text-muted"},t.status)),r.a.createElement("td",{className:"text-right align-middle pr-0"},E," ",g))},N=function(e){var t=e.modal,a=e.toggle,n=e.content,c=e.fn,l=r.a.createElement("button",{className:"close btn btn-round",type:"button",onClick:a},r.a.createElement("span",{"aria-hidden":"true"},"\xd7"));return r.a.createElement(f.a,{isOpen:t,toggle:a,backdrop:"static"},r.a.createElement(d.a,{close:l},"Alert"),r.a.createElement(E.a,null,n),c&&r.a.createElement(v.a,null,r.a.createElement(p.a,{onClick:c},"Submit")))},S=function(){var e=Object(n.useState)([]),t=Object(u.a)(e,2),a=t[0],c=t[1],l=Object(n.useState)(null),o=Object(u.a)(l,2),p=o[0],f=o[1],d=Object(n.useState)(!1),E=Object(u.a)(d,2),b=E[0],g=E[1],h=Object(n.useState)(!1),v=Object(u.a)(h,2),w=v[0],j=v[1],x=Object(n.useState)(""),O=Object(u.a)(x,2),y=O[0],S=O[1],F=function(e){w?(S(""),j(!1)):(S(e),j(!0))},R=function(){var e=Object(s.a)(i.a.mark((function e(t,a){var n,r;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch("/private/".concat(t),{method:"post",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)});case 2:return n=e.sent,e.next=5,n.json();case 5:(r=e.sent).command&&F(r.command),A(!1);case 8:case"end":return e.stop()}}),e)})));return function(t,a){return e.apply(this,arguments)}}(),A=function(){var e=Object(s.a)(i.a.mark((function e(){var t,a,n,r,l,o=arguments;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=!(o.length>0&&void 0!==o[0])||o[0],e.prev=1,t&&g(!0),e.next=5,fetch("/private/mapping");case 5:return a=e.sent,e.next=8,a.json();case 8:return n=e.sent,f(n),e.next=12,fetch("/private/worker");case 12:return r=e.sent,e.next=15,r.json();case 15:(l=e.sent).sort((function(e,t){return null===e.createdAt&&null===t.createdAt?t.version.localeCompare(e.version):null===e.createdAt?1:null===t.createdAt?-1:new Date(t.createdAt)-new Date(e.createdAt)})),c(l),t&&g(!1),e.next=24;break;case 21:e.prev=21,e.t0=e.catch(1),console.error(e.t0);case 24:case"end":return e.stop()}}),e,null,[[1,21]])})));return function(){return e.apply(this,arguments)}}();return Object(n.useEffect)((function(){A()}),[]),r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{className:"d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center mb-2"},r.a.createElement("h2",null,"Workers"),r.a.createElement("div",{className:"btn-toolbar mb-2 mb-md-0"},r.a.createElement(k,{createWorker:function(e){return R("/worker/add",e)}}))),r.a.createElement("div",{id:"workers",className:"mb-4"},b||0===a.length?"Loading...":r.a.createElement(m.a,{className:"mt-3"},r.a.createElement("tbody",null,a.map((function(e){return r.a.createElement(C,{key:e.id,worker:e,mapping:p[e.prefix],runAction:R})}))))),r.a.createElement("div",null,r.a.createElement("h4",null,"Instructions"),r.a.createElement("ul",null,r.a.createElement("li",null,"To add a worker, either turn on an auto-updater, or grab a version string from"," ",r.a.createElement("a",{href:"https:waka.app/a/nz-wlg/info"},"waka.app/a/nz-wlg/info"),"."),r.a.createElement("li",null,"If you're running this locally, the import is not automatic. Use the actions menu to get a Docker command that will populate your database."),r.a.createElement("li",null,"If you use the Docker command, shapes will also not be imported by default."))),w&&r.a.createElement(N,{toggle:F,content:y,modal:w}))},F=a(89),R=a(90),A=a(91),D=a(92),I=a(93),J=a(25),W=function(){return r.a.createElement(F.a,{color:"dark",dark:!0,expand:"md"},r.a.createElement(R.a,{className:"d-flex justify-content-between"},r.a.createElement(J.b,{to:"/",className:"navbar-brand d-flex align-items-center"},r.a.createElement("strong",null,"Waka"),"\xa0Orchestrator"),r.a.createElement(A.a,{className:"collapse navbar-collapse",id:"navbarCollapse"},r.a.createElement(D.a,{className:"mr-auto",navbar:!0},r.a.createElement(I.a,null,r.a.createElement(J.b,{to:"/config",className:"nav-link"},"Configuration"))))))},z=a(19),T=function(){var e=Object(n.useState)(""),t=Object(u.a)(e,2),a=t[0],c=t[1],l=Object(n.useState)(""),o=Object(u.a)(l,2),m=o[0],f=o[1],d=Object(n.useState)(""),E=Object(u.a)(d,2),b=E[0],g=E[1],h=Object(n.useState)(!1),v=Object(u.a)(h,2),k=v[0],w=v[1],j=Object(n.useState)(""),x=Object(u.a)(j,2),O=x[0],y=x[1],C=Object(n.useState)(!1),S=Object(u.a)(C,2),F=S[0],R=S[1],A=function(e){k?(y(""),w(!1)):(y(e),w(!0))},D=function(){R(!F)},I=function(){var e=Object(s.a)(i.a.mark((function e(){return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,J("orchestrator/kill");case 3:D(),e.next=9;break;case 6:e.prev=6,e.t0=e.catch(0),A("something bad happened");case 9:case"end":return e.stop()}}),e,null,[[0,6]])})));return function(){return e.apply(this,arguments)}}(),J=function(){var e=Object(s.a)(i.a.mark((function e(t,a){var n,r;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch("/private/".concat(t),{method:"post",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)});case 2:return n=e.sent,e.next=5,n.json();case 5:(r=e.sent).command&&A(r.command),W();case 8:case"end":return e.stop()}}),e)})));return function(t,a){return e.apply(this,arguments)}}(),W=function(){var e=Object(s.a)(i.a.mark((function e(){var t,a;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch("/private/config");case 2:return t=e.sent,e.next=5,t.json();case 5:a=e.sent,c(JSON.stringify(a.config," ",2)),f(JSON.stringify(a.configRealtime," ",2));case 8:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),z=function(){var e=Object(s.a)(i.a.mark((function e(){var t,a;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch("/private/git");case 2:return t=e.sent,e.next=5,t.text();case 5:a=e.sent,g(a);case 7:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return Object(n.useEffect)((function(){W(),z()}),[]),r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{className:"mb-4"},r.a.createElement("h4",null,"Deployed Version"),r.a.createElement("div",{className:"bg-dark"},r.a.createElement("pre",{className:"text-light p-4",id:"footer"},b))),r.a.createElement("div",{className:"d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center mb-1"},r.a.createElement("h2",null,"Config"),r.a.createElement("div",{className:"btn-toolbar mb-2 mb-md-0"},r.a.createElement(p.a,{size:"sm",outline:!0,color:"danger",onClick:D},"Restart Orchestrator"),"\xa0",r.a.createElement(p.a,{size:"sm",outline:!0,color:"primary",onClick:function(){try{var e={config:JSON.parse(a),configRealtime:JSON.parse(m)};J("config",e)}catch(t){A("Error in JSON")}}},"Save Config"))),r.a.createElement("div",{className:"mb-4"},r.a.createElement("div",{className:"form-group"},r.a.createElement("textarea",{className:"form-control pre",rows:"36",value:a,onChange:function(e){return c(e.target.value)}}),r.a.createElement("small",{className:"form-text text-muted"},"You can override the"," ",r.a.createElement("a",{href:"https://github.com/dymajo/waka-server/blob/master/waka-orchestrator/configManager.js"},"default config")," ","by putting values in here. However, you will need to restart the app!"))),r.a.createElement("h2",null,"Realtime Config"),r.a.createElement("div",{className:"mb-4"},r.a.createElement("div",{className:"form-group"},r.a.createElement("textarea",{className:"form-control pre",rows:"16",value:m,onChange:function(e){return f(e.target.value)}}),r.a.createElement("small",{className:"form-text text-muted"},"This configuration is only used if realtime is running as a seperate process. When running as seperate processes, it is recommended that you change the keyvalue implementation to dynamo."))),k&&r.a.createElement(N,{toggle:A,content:O,modal:k}),F&&r.a.createElement(N,{toggle:D,content:"Are you sure you want to restart the orchestrator?\nDepending on your environment, it may not restart automatically.",modal:F,fn:I}))};var V=function(){return r.a.createElement(J.a,{basename:"/private"},r.a.createElement(W,null),r.a.createElement("div",{className:"container main-container pt-5"},r.a.createElement(z.c,null,r.a.createElement(z.a,{exact:!0,path:"/config",component:T}),r.a.createElement(z.a,{exact:!0,path:"/",component:S}))))};l.a.render(r.a.createElement(V,null),document.getElementById("root"))}},[[49,1,2]]]);
//# sourceMappingURL=main.071ca2f4.chunk.js.map